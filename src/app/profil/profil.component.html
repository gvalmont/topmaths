<div class="columns centre">
  <div class="column is-one-fifth"></div>
  <div class="column is-three-fifths">
    <!-- Pseudo -->
    <div>
      <a (click)="ouvrirModale('pseudo')">
        <h1 class="title is-2 is-inline-block">{{dataService.user.pseudo}}</h1>&nbsp;
        <i class="image is-24x24 is-inline-block"><img src="assets/img/cc0/edit-svgrepo-com.svg" /></i>
      </a>
    </div>
    <!-- Avatar -->
    <div>
      <a routerLink="/profil/avatar/couleur" routerLinkActive="active">
        <figure class="avatar is-inline-block is-large" [style]="dataService.styleAvatar"></figure>
        <i class="image is-24x24 is-inline-block"><img src="assets/img/cc0/edit-svgrepo-com.svg" /></i>
      </a>
    </div>
    <br>
    <!-- Score -->
    <div>
      <h2 class="title">Mon score : {{dataService.user.score}}</h2>
    </div>
    <br>
    <!-- Équipe -->
    <div *ngIf="dataService.user.teamName != ''">
      <a (click)="voirPageEquipe()">
        <button class="button is-info is-large">Page de la TEAM {{ dataService.user.teamName }}</button>
      </a>
    </div>
    <!-- Rejoindre une équipe -->
    <div class="columns is-centered">
      <div class="column is-narrow">
        <div *ngIf="dataService.user.teamName == ''" class="dropdown is-hoverable">
          <div class="dropdown-trigger">
            <!-- Champ de connexion -->
            <form [formGroup]="angFormE" (ngSubmit)="dataService.rejoindreEquipe(angFormE.value.codeEquipe)" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
              <div class="field is-inline-block">
                <div [ngClass]="{'control has-icons-left has-icons-right': true, 'shake': shakeE}">
                  <!-- Champ en lui-même -->
                  <input [ngClass]="{'input': true, 'is-success': (!errPetitNbCharE && !errGrandNbCharE && !errSpCharE && !defautE && !errCodeIncorrectE), 'is-danger': (errPetitNbCharE || errGrandNbCharE || errSpCharE || errCodeIncorrectE)}" type="text" name="codeEquipe" formControlName="codeEquipe" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Code équipe" size="7">
                  <!-- icônes de part et d'autre du champ -->
                  <span class="icon is-small is-left filter-grey">
                    <i class="image is-24x24"><img src="assets/img/cc0/users-267.svg" /></i>
                  </span>
                  <span *ngIf="(!errPetitNbCharE && !errGrandNbCharE && !errSpCharE && !defautE)" class="icon is-small is-right filter-grey">
                    <i class="image is-24x24"><img src="assets/img/cc0/check-svgrepo-com.svg" /></i>
                  </span>
                  <span *ngIf="(errPetitNbCharE || errGrandNbCharE || errSpCharE)" class="icon is-small is-right filter-grey">
                    <i class="image is-24x24"><img src="assets/img/cc0/warning-exclamation-sign-in-filled-triangle-svgrepo-com.svg" /></i>
                  </span>
                </div>
              </div>
              &nbsp;
              <!-- Bouton d'envoi -->
              <button type="submit" class="button is-info is-inline-block">Rejoindre l'équipe</button>
              <!-- Indications sous le champ -->
              <div *ngIf="(!errPetitNbCharE && !errGrandNbCharE && !errSpCharE && !defautE && !errCodeIncorrectE)" class="has-text-success">Ça a l'air bon !</div>
              <div *ngIf="errPetitNbCharE" class="has-text-danger">C'est trop court !</div>
              <div *ngIf="errGrandNbCharE" class="has-text-danger">C'est trop long !</div>
              <div *ngIf="errSpCharE" class="has-text-danger">Il ne faut que des lettres en minuscule !</div>
              <div *ngIf="errCodeIncorrectE" class="has-text-danger">Code incorrect</div>
            </form>
          </div>
          <div class="dropdown-menu">
            <div class="dropdown-content">
              <div class="dropdown-item is-size-6">
                <p>Si tu veux rejoindre l'équipe de quelqu'un d'autre,
                  tu peux entrer le code d'équipe qu'il ou elle t'a donné.
                </p>
              </div>
            </div>
          </div>
        </div>
        <div *ngIf="dataService.user.teamName == ''">
          <a (click)="creerNouvelleEquipe()">
            <button class="button is-info is-outlined">Créer une nouvelle équipe</button>
          </a>
        </div>
      </div>
    </div>
    <!-- Trophées -->
    <div *ngIf="dataService.user.codeTrophees != ''">
      <a (click)="voirTropheesPerso()">
        <button class="button is-success is-large">Lien vers les trophées</button>
      </a>
    </div>
    <!-- Paramètres -->
    <br><br>
    <!-- Scores -->
    <button *ngIf="dataService.user.scores == 'actives'" type="submit" class="button is-danger is-outlined" (click)="dataService.majScores('desactives'); enCoursDeModif = 'scores'; modifTerminee = ''">
      Désactiver les scores
    </button>
    <button *ngIf="dataService.user.scores != 'actives'" class="button is-danger">
      Les scores sont désactivés
    </button>
    &nbsp;
    <button *ngIf="dataService.user.scores != 'actives'" type="submit" class="button is-success is-outlined" (click)="dataService.majScores('actives'); enCoursDeModif = 'scores'; modifTerminee = ''">
      Activer les scores
    </button>
    <button *ngIf="dataService.user.scores == 'actives'" class="button is-success">
      Les scores sont activés
    </button>
    &nbsp;
    <figure *ngIf="enCoursDeModif == 'scores'" class="image is-32x32 is-inline-block">
      <img [src]="'assets/img/Loading.gif'">
    </figure>
    <i *ngIf="modifTerminee == 'scores'" class="image is-32x32 is-inline-block">
      <img src="assets/img/cc0/check-svgrepo-com.svg" />
    </i>
    <br><br>
    <!-- Anonymat -->
    <button *ngIf="dataService.user.visible == 'oui'" type="submit" class="button is-danger is-outlined" (click)="dataService.majVisible('non'); enCoursDeModif = 'visible'; modifTerminee = ''">
      Ne pas apparaître dans les personnes en ligne
    </button>
    <button *ngIf="dataService.user.visible != 'oui'" class="button is-danger">
      Tu n'apparais pas dans les personnes en ligne
    </button>
    &nbsp;
    <button *ngIf="dataService.user.visible != 'oui'" type="submit" class="button is-success is-outlined" (click)="dataService.majVisible('oui'); enCoursDeModif = 'visible'; modifTerminee = ''">
      Apparaître dans les personnes en ligne
    </button>
    <button *ngIf="dataService.user.visible == 'oui'" class="button is-success">
      Tu apparais dans les personnes en ligne
    </button>
    &nbsp;
    <figure *ngIf="enCoursDeModif == 'visible'" class="image is-32x32 is-inline-block">
      <img [src]="'assets/img/Loading.gif'">
    </figure>
    <i *ngIf="modifTerminee == 'visible'" class="image is-32x32 is-inline-block">
      <img src="assets/img/cc0/check-svgrepo-com.svg" />
    </i>
    <br><br>
    <!-- Trophées -->
    <div *ngIf="dataService.user.codeTrophees != ''">
      <button *ngIf="dataService.user.tropheesVisibles == 'oui'" type="submit" class="button is-danger is-outlined" (click)="dataService.majTropheesVisibles('non'); enCoursDeModif = 'trophees'; modifTerminee = ''">
        Cacher ses trophées aux autres utilisateurs
      </button>
      <button *ngIf="dataService.user.tropheesVisibles != 'oui'" class="button is-danger">
        Tes trophées sont cachés aux autres utilisateurs
      </button>
      &nbsp;
      <button *ngIf="dataService.user.tropheesVisibles != 'oui'" type="submit" class="button is-success is-outlined" (click)="dataService.majTropheesVisibles('oui'); enCoursDeModif = 'trophees'; modifTerminee = ''">
        Montrer ses trophées aux autres utilisateurs
      </button>
      <button *ngIf="dataService.user.tropheesVisibles == 'oui'" class="button is-success">
        Tes trophées sont visibles par les autres utilisateurs
      </button>
      &nbsp;
      <figure *ngIf="enCoursDeModif == 'trophees'" class="image is-32x32 is-inline-block">
        <img [src]="'assets/img/Loading.gif'">
      </figure>
      <i *ngIf="modifTerminee == 'trophees'" class="image is-32x32 is-inline-block">
        <img src="assets/img/cc0/check-svgrepo-com.svg" />
      </i>
    </div>
    <div *ngIf="dataService.user.codeTrophees != ''"><br></div>
    <!-- Créer le lien vers les trophées -->
    <div class="columns is-centered">
      <div class="column is-narrow">
        <div *ngIf="dataService.user.codeTrophees == ''" class="dropdown is-hoverable">
          <div class="dropdown-trigger">
            <!-- Champ de connexion -->
            <form [formGroup]="angForm" (ngSubmit)="lierTrophees(angForm.value.codeTrophee)" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
              <div class="field is-inline-block">
                <div [ngClass]="{'control has-icons-left has-icons-right': true, 'shake': shake}">
                  <!-- Champ en lui-même -->
                  <input [ngClass]="{'input': true, 'is-success': (!errPetitNbChar && !errGrandNbChar && !errSpChar && !defaut && !errCodeIncorrect), 'is-danger': (errPetitNbChar || errGrandNbChar || errSpChar || errCodeIncorrect)}" type="codeTrophee" name="codeTrophee" formControlName="codeTrophee" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="form-control input-sm" placeholder="Code Trophées" size="5">
                  <!-- icônes de part et d'autre du champ -->
                  <span class="icon is-small is-left filter-grey">
                    <i class="image is-24x24"><img src="assets/img/cc0/trophy-svgrepo-com.svg" /></i>
                  </span>
                  <span *ngIf="(!errPetitNbChar && !errGrandNbChar && !errSpChar && !defaut)" class="icon is-small is-right filter-grey">
                    <i class="image is-24x24"><img src="assets/img/cc0/check-svgrepo-com.svg" /></i>
                  </span>
                  <span *ngIf="(errPetitNbChar || errGrandNbChar || errSpChar)" class="icon is-small is-right filter-grey">
                    <i class="image is-24x24"><img src="assets/img/cc0/warning-exclamation-sign-in-filled-triangle-svgrepo-com.svg" /></i>
                  </span>
                </div>
              </div>
              &nbsp;
              <!-- Bouton d'envoi -->
              <button type="submit" class="button is-success is-inline-block">Créer le lien</button>
              <!-- Indications sous le champ -->
              <div *ngIf="(!errPetitNbChar && !errGrandNbChar && !errSpChar && !defaut && !errCodeIncorrect)" class="has-text-success">Ça a l'air bon !</div>
              <div *ngIf="errPetitNbChar" class="has-text-danger">C'est trop court !</div>
              <div *ngIf="errGrandNbChar" class="has-text-danger">C'est trop long !</div>
              <div *ngIf="errSpChar" class="has-text-danger">Il ne faut que des lettres en minuscule !</div>
              <div *ngIf="errCodeIncorrect" class="has-text-danger">Code incorrect</div>
            </form>
          </div>
          <div class="dropdown-menu">
            <div class="dropdown-content">
              <div class="dropdown-item is-size-6">
                <p>Si tu es un élève d'une 5ème ou d'une 4ème de M. Valmont,
                  il t'a donné un code permettant d'accéder à ta liste de trophées.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Quitter l'équipe -->
    <div *ngIf="dataService.user.teamName != ''">
      <br>
      <button (click)="quitterEquipe()" class="button is-danger">Quitter la TEAM {{ dataService.user.teamName }}</button>
      <br>
    </div>
    <!-- Supprimer le lienTrophees -->
    <div *ngIf="dataService.user.codeTrophees != ''">
      <br>
      <button (click)="supprimerLienTrophees()" class="button is-danger">Supprimer le lien vers les trophées</button>
      <br>
    </div>
    <br><br>
    <!-- Déconnexion -->
    <div *ngIf="dataService.user.lastLogin != '' && derniereConnexion != 'undefined NaN undefined NaN à NaNhNaNmin'">
      <p class="has-text-grey is-size-6">Quelqu'un s'est connecté sur ce compte le {{derniereConnexion}}.<br>
        Si cette date ne te dit rien, c'est sûrement que ton identifiant est trop facile à deviner ou que tu as oublié
        de te déconnecter et que quelqu'un d'autre l'a utilisé !</p>
      <div><br></div>
    </div>
    <button class="button is-warning" (click)="dataService.logout()">Se déconnecter</button>
  </div>
  <div class="column is-one-fifth">
    <!-- Utilisateurs connectés -->
    <app-whosonline></app-whosonline>
  </div>
</div>

<!-- Modale de création de pseudo -->
<div id="modalePseudo" class="modal centre">
  <div class="modal-background" (click)="fermerModale('pseudo')"></div>
  <div><br><br><br></div>
  <div class="modal-content has-background-white">
    <!-- Pseudo -->
    <br><br>
    <h1 class="title is-2">{{pseudo}}</h1>
    <br><br>
    <!-- Boutons -->
    <div class="columns">
      <div class="column is-5 is-flex is-align-items-center is-justify-content-center">
        <button (click)="fermerModale('pseudo')" class="button is-danger">Annuler</button>
      </div>
      <div class="column is-2 is-flex is-align-items-center is-justify-content-center">
        <a>
          <figure (click)="pseudoAleatoire()" class="image is-64x64 is-inline-block">
            <img src="assets/img/cc0/dice-svgrepo-com.svg" />
          </figure>
        </a>
      </div>
      <div class="column is-5 is-flex is-align-items-center is-justify-content-center">
        <button (click)="enregistrerPseudo()" class="button is-success">Enregistrer</button>
      </div>
    </div>
    <br><br><br>
    <!-- Paramètres -->
    <button *ngIf="dataService.feminin" type="submit" class="button is-info is-light" (click)="dataService.majFeminin(false)">Pseudo masculin</button>
    <button *ngIf="!dataService.feminin" class="button is-info">Pseudo masculin</button>
    &nbsp;
    <button *ngIf="!dataService.feminin" type="submit" class="button is-sponsor is-light" (click)="dataService.majFeminin(true)">Pseudo féminin</button>
    <button *ngIf="dataService.feminin" class="button is-sponsor">Pseudo féminin</button>
    <br><br>
  </div>
  <button class="modal-close is-large" aria-label="close" (click)="fermerModale('pseudo')"></button>
</div>

<!-- Modale de confirmation -->
<div id="modaleConfirmation" class="modal centre">
  <div class="modal-background" (click)="fermerModale('confirmation')"></div>
  <div><br><br><br></div>
  <div class="modal-content has-background-white px-6">
    <!-- Texte -->
    <br><br>
    <p>
      Si tu quittes la TEAM {{ dataService.user.teamName }},
      le nombre de points que tu as fait gagné à l'équipe sera réinitialisé
      et tu vas avoir besoin du code d'équipe si tu veux la rejoindre à nouveau
    </p>
    <br>
    <p *ngIf="dataService.user.id == dataService.infosEquipe.leader">
      De plus, plus personne ne pourra modifier l'emblème de l'équipe.
    </p>
    <div *ngIf="dataService.user.id == dataService.infosEquipe.leader"><br></div>
    <p>
      Tu es{{ dataService.user.id == dataService.infosEquipe.leader ? ' vraiment' : ' ' }} sûr(e) de vouloir la quitter ?
    </p>
    <br><br>
    <!-- Boutons -->
    <div class="columns">
      <div class="column is-5 is-flex is-align-items-center is-justify-content-center">
        <button (click)="fermerModale('confirmation')" class="button is-danger">Annuler</button>
      </div>
      <div class="column is-2 is-flex is-align-items-center is-justify-content-center">
      </div>
      <div class="column is-5 is-flex is-align-items-center is-justify-content-center">
        <button (click)="dataService.quitterEquipe(); fermerModale('confirmation')" class="button is-success">Continuer</button>
      </div>
    </div>
    <br><br><br>
  </div>
  <button class="modal-close is-large" aria-label="close" (click)="fermerModale('confirmation')"></button>
</div>